<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>학교폭력 도우미</title>

<style>
:root{
  --bg:#FFE8CC;         /* 페이지 배경 */
  --card:#FFF9F0;       /* 카드·버블 배경 */
  --header:#FFE4B5;     /* 헤더 */
  --accent:#87B071;     /* 전송 버튼, 포인트 */
  --accent-d:#76A061;
  --border:#FFD4A3;
}
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}

body{background:var(--bg);display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px}

#chat-container{
  width:100%;max-width:450px;height:700px;background:var(--card);
  display:flex;flex-direction:column;border-radius:24px;overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,.1)
}

/* ===== HEADER ===== */
#header{background:var(--header);padding:20px;text-align:center;border-bottom:1px solid var(--border)}
.mascot{display:inline-flex;align-items:center;gap:12px;background:var(--card);
        padding:10px 20px;border-radius:20px;margin-bottom:8px}
.mascot h1{font-size:18px;font-weight:600;color:#8B6914}
.date{font-size:14px;color:#A0826D}

/* ===== CHAT WINDOW ===== */
#chat-window{flex:1;overflow-y:auto;padding:20px;background:var(--card)}
#chat-window::-webkit-scrollbar{width:6px}
#chat-window::-webkit-scrollbar-thumb{background:var(--header);border-radius:3px}

.message{display:flex;align-items:flex-end;gap:8px;margin-bottom:16px;animation:fade .3s}
@keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.message-bubble{max-width:75%;padding:12px 16px;border-radius:20px;line-height:1.5;word-break:keep-all}
.bot .message-bubble{background:#fff;border:1px solid var(--header);border-bottom-left-radius:4px}
.user .message-bubble{background:#B8D4A8;color:#2C5530;border-bottom-right-radius:4px}
.user{flex-direction:row-reverse}
.avatar{width:36px;height:36px;border-radius:50%;background:var(--header);display:flex;align-items:center;justify-content:center;font-size:20px}

/* typing indicator */
.typing-indicator{display:flex;align-items:center;gap:4px;padding:12px 16px}
.typing-indicator span{width:8px;height:8px;background:#A0826D;border-radius:50%;animation:blink 1.4s infinite}
.typing-indicator span:nth-child(2){animation-delay:.2s}
.typing-indicator span:nth-child(3){animation-delay:.4s}
@keyframes blink{0%,60%,100%{opacity:.3}30%{opacity:1}}

/* ===== INPUT AREA ===== */
#input-area{padding:16px;background:#fff;border-top:1px solid var(--border)}
#chat-form{display:flex;gap:8px;align-items:center}
.input-wrapper{flex:1;display:flex;align-items:center;background:var(--card);
               border:1px solid var(--border);border-radius:24px;padding:6px 12px}
.input-wrapper:focus-within{border-color:var(--border)}
#user-input{flex:1;border:none;background:none;font-size:15px;outline:none;color:#333}
#user-input::placeholder{color:#A0826D}
#submit-button{
  width:40px;height:40px;border:none;border-radius:50%;flex-shrink:0;
  background:var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer
}
#submit-button:hover{background:var(--accent-d);transform:scale(1.08)}
#submit-button:disabled{background:#D3D3D3;cursor:not-allowed}

/* 모바일 전체화면 */
@media(max-width:480px){
  body{padding:0}
  #chat-container{height:100vh;border-radius:0}
}
</style>
</head>
<body>
<div id="chat-container">
  <!-- HEADER -->
  <div id="header">
    <div class="mascot"><span style="font-size:28px">🐱</span><h1>학교폭력 도우미</h1></div>
    <div class="date" id="current-date"></div>
  </div>

  <!-- CHAT -->
  <div id="chat-window">
    <div class="message bot">
      <div class="avatar">📚</div>
      <div class="message-bubble">
        안녕하세요! 👋<br>
        학교폭력 관련 매뉴얼을 도와드릴게요.<br>
        궁금한 것을 편하게 물어보세요!
      </div>
    </div>
  </div>

  <!-- INPUT -->
  <div id="input-area">
    <form id="chat-form" onsubmit="return false;">
      <div class="input-wrapper">
        <input id="user-input" type="text" placeholder="메시지를 입력하세요…" autocomplete="off" />
      </div>
      <button id="submit-button" type="button" title="전송">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 2 11 13"/><path d="M22 2 15 22 11 13 2 9 22 2Z"/>
        </svg>
      </button>
    </form>
  </div>
</div>

<script>
const chatWindow = document.getElementById('chat-window');
const userInput   = document.getElementById('user-input');
const submitBtn   = document.getElementById('submit-button');

/* 날짜 */
document.getElementById('current-date').textContent =
  new Date().toLocaleDateString('ko-KR',{month:'long',day:'numeric',weekday:'long'});

/* 전송 버튼 & 엔터 */
submitBtn.onclick = sendMessage;
userInput.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); sendMessage(); }
});

function sendMessage(){
  const msg = userInput.value.trim();
  if(!msg) return;
  appendMessage('user',msg);
  userInput.value=''; toggleInput(false);
  const typing = showTyping();

  fetch('/chat',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({message:msg})
  })
  .then(r=>r.json())
  .then(d=>appendMessage('bot',d.reply||d.error))
  .catch(()=>appendMessage('bot','죄송합니다, 오류가 발생했습니다. 😢'))
  .finally(()=>{ hideTyping(typing); toggleInput(true); userInput.focus(); });
}

/* 메시지 UI */
function appendMessage(type,text){
  const wrap=document.createElement('div');wrap.className='message '+type;
  if(type==='bot'){
    wrap.innerHTML=`<div class="avatar">📚</div>
        <div class="message-bubble">${text.replace(/\n/g,'<br>')}</div>`;
  }else{
    wrap.innerHTML=`<div class="message-bubble">${text.replace(/\n/g,'<br>')}</div>`;
  }
  chatWindow.appendChild(wrap);
  chatWindow.scrollTop=chatWindow.scrollHeight;
}

/* typing indicator */
function showTyping(){
  const div=document.createElement('div');
  div.className='message bot typing-indicator';
  div.innerHTML=`<div class="avatar">📚</div>
      <div class="message-bubble typing-indicator">
        <span></span><span></span><span></span>
      </div>`;
  chatWindow.appendChild(div); chatWindow.scrollTop=chatWindow.scrollHeight; return div;
}
function hideTyping(el){ if(el) el.remove(); }

/* input lock */
function toggleInput(on){ userInput.disabled=!on; submitBtn.disabled=!on; }
</script>
</body>
</html>
